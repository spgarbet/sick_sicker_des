---
title: "Sick Sicker Simmer Constrained (Part 2)"
author: "Shawn Garbett, John Graves"
format: html
editor: source
---

## Goal

Sick/Sicker with resource constraints in DES.

A continuation of [Part 1](http://htmlpreview.github.io/?https://github.com/spgarbet/sick_sicker_des/master/Sick_Sicker_Simmer_DES.html).

The Sick/Simmer model constructed previously did not use the full power of
what discrete event simulation has to offer. This will build on the previous
work and include a demonstration of the effects of a resource constraint.

> *"Art in nature is rhythmic and has a horror of constraints."* --Robert Delaunay

### Technical Details

One thing to be aware of is that if one were to execute each patient trajectory
as a simulation outside of a discrete event simulation (DES) framework it would
likely have much higher performance. A DES framework has to execute all trajectories
at the same time, evaluate them all to check for any resource contention and this
penalty is fixed whether or not the model has resource constraints. A large
number of cost effectiveness studies utilizing DES do not have constrained
resources. To put the problem in perspective, independent simulations are
$\mathcal{O}(n)$ in complexity of execution. Meaning the total time/memory
utilization is proportional to the number of individuals simulated. DES
requires the fixed cost of resource contention checking, and has to manage this
utilizing a heap and this makes the complexity $\mathcal{O}(n \log n)$. This is
a theoretical limitation based on complexity.

In earlier unpublished [work](https://github.com/spgarbet/sick_sicker_des) we^[Shawn Garbett, Fernando Alarid-Escudero, Cole Beck] quantified the differences using a Sick Sicker model.

![](des_versus_dt.png)

This shows that in a practical case, when $N >= 100,000$ the 
simmer based DES solution because impractical. For our in house
models using simmer we batched them into units of 100,000 
patients and ran using the method outlined in our
[ACCRE](https://github.com/vubiostat/accre_tutorial) tutorial.

If one needs a full DES due to resource constraints, this problem is not
easily avoidable--and the $N$ of single DES simulation becomes the number contending
for a finite resource.

## Modified Problem Statement

What if there were resource constraints (e.g. facilities) to get patients 
inducted onto medication and the process took time? We are doing to split 
the state of "Sick 1" or S1 into S1U "Sick 1 Untreated" and "Sick 1 Treated"
and introduce treatment induction resource constraint, sometimes called 
a "tunnel state". In this case there is a queue to enter the tunnel. 

The focus of the model now shifts from comparing treatment to no treatment, to 
doing a profile of the impact of investment on reduction of waiting. 

We copy `inputs.R` to `inputs2.R` (Please note, in practice renaming files like
this should not be done and one would use git to track versions of a file like
inputs, but for pedantic purposes we have all versions available in a flat 
archive) and make the following edits:


```
    strategy = 'notreat',# Default strategy is no treatment
    
    # Resource Constraint
    n.induct = 10,       # Number of individuals who can be inducted in treatment
    t.induct = 0.5,      # Number of years to induct treatment
    c.facility = 5e5     # Cost to build a new facility
```

